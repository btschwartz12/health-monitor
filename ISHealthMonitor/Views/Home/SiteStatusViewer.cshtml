@{
	ViewData["Title"] = "Configuration History Page";
	ViewData["UserName"] = ViewBag.UserName;
	ViewData["UserIsAdmin"] = ViewBag.UserIsAdmin;
}




<div class="container" id="divLoading">
	<div class="row">
		<div class="form-group col-12">
			<div style="display:inline-block; margin-left: 20px;">
				Loading... <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
			</div>
		</div>
	</div>
</div>


<div class="container text-center">

	<h1>
		Site Status Viewer
	</h1>

	<hr />


	<div class="row justify-content-center  my-4">
		<div class="col-1 d-flex justify-content-center align-items-start pt-1">
			<i class="fas fa-info-circle fa-3x"></i>
		</div>
		<div class="col-11 col-md-8 text-left">
			<p>Here are the statuses for each tracked site, including the expiration date, and the number of users who are subscribed to its expiration.</p>

		</div>
	</div>

	<hr />

	<table id="siteStatusTable" class="table table-striped display compact wrap" style="border: 1px solid #aaa;"></table>


</div>



@section Scripts{

	<script src="~/js/DatatableRequests.js" asp-append-version="true"></script>


	<script>
		var buttonCommon = {
			exportOptions: {
				columns: [0, 1, 2, 3]
			}
		};


		siteStatusDataTable = $('#siteStatusTable').DataTable({

			"autoWidth": false,
			"scrollX": true,
			"columns": [
				{
					"sTitle": "ID",
					"data": "SiteID"
				},
				{
					"sTitle": "Name",
					"data": "SiteName"
				},
				{
					"sTitle": "URL",
					"data": "SiteURL"
				},
				{
					"sTitle": "Expiration\nDate",
					"data": "SSLExpirationDate"
				},
				{
					"sTitle": "Expires",
					"data": "TimeUntilExpiration"
				},
				{
					"sTitle": "# Subscribers",
					"data": "NumSubscribedUsers"
				},

				
			],

			dom: 'Bfrtip',
			lengthMenu: [
				[10, 50, 100, -1],
				['10', '50', '100', 'All']
			],
			buttons: [
				'pageLength',
				$.extend(true, {}, buttonCommon, {
					extend: 'copyHtml5',
					title: "Training Billing Discounts"
				}),
				$.extend(true, {}, buttonCommon, {
					extend: 'excelHtml5',
					title: "Training Billing Discounts"
				}),
				$.extend(true, {}, buttonCommon, {
					extend: 'pdfHtml5',
					title: "Training Billing Discounts",
					orientation: 'landscape',
					customize: function (doc) {
						doc.pageMargins = [5, 5, 0, 0];
						doc.defaultStyle.fontSize = 8;
						doc.styles.tableHeader.fontSize = 9;
					}
				})
			]
		});

		DATATABLE_REQUESTS.LoadSiteStatusTable();
	</script>


	<script>

		// TODO admin
		$(document).ready(function () {

				var table = $('#siteStatusTable').DataTable();

				$('#siteStatusTable tbody').on('mouseenter', 'tr', function () {
					// Access the TooltipInfo data
					var data = table.row(this).data();

					// Generate the tooltip text
					var tooltipText = "";
					for (var userName in data.UsersSubscribed) {
						tooltipText += "<strong>" + userName + "</strong>" + "<br/>" + data.UsersSubscribed[userName].join(', ') + "<br/><br/>";
					}

					// Remove last line breaks
					tooltipText = tooltipText.replace(/<br\/><br\/>$/, '');

					$(this).attr('title', tooltipText);
					$(this).attr('data-toggle', 'tooltip');
					$(this).tooltip({
						placement: 'left',
						html: true
					});
					$(this).tooltip('show');
				});
			

		});

	</script>
}
